service: aws-finaltest
configValidationMode: error
frameworkVersion: "3"
useDotenv: true

provider:
  name: aws
  runtime: nodejs20.x
  stage: ${opt:stage, 'prod'}
  region: ${opt:region, 'us-east-1'}
  memorySize: 512
  environment:
    COGNITO_CLIENT_ID: ${env:COGNITO_CLIENT_ID}
    REGION: ${env:REGION}
    COGNITO_USER_POOL_ID: ${env:COGNITO_USER_POOL_ID}
    S3_BUCKET: ${env:S3_BUCKET}
    TURSO_DATABASE_URL: ${env:TURSO_DATABASE_URL}
    TURSO_AUTH_TOKEN: ${env:TURSO_AUTH_TOKEN}
  iam:
    role:
      statements:
        - Effect: "Allow"
          Action:
            - "s3:GetObject"
            - "s3:PutObject"
          Resource:
            - "arn:aws:s3:::${env:S3_BUCKET}"
            - "arn:aws:s3:::${env:S3_BUCKET}/*"
        - Effect: "Allow"
          Action:
            - "cognito-idp:AdminConfirmSignUp"
          Resource:
            - "*"
        - Effect: "Allow"
          Action:
            - "logs:CreateLogGroup"
            - "logs:CreateLogStream"
            - "logs:PutLogEvents"
          Resource:
            - "*"
custom:
  prune:
    automatic: true
    number: 0

functions:
  health: ${file(src/functions/health/index.yml):health}

  # USER
  createUser: ${file(src/functions/user/create/index.yml):createUser}
  findUser: ${file(src/functions/user/find/index.yml):findUser}
  loginUser: ${file(src/functions/user/logIn/index.yml):userLogin}
  updateUser: ${file(src/functions/user/update/index.yml):updateUser}

  # MENTORSHIP
  createMentorship: ${file(src/functions/Mentorship/create/index.yml):createMentorship}
  findMentorship: ${file(src/functions/Mentorship/find/index.yml):findMentorship}
  listMentorship: ${file(src/functions/Mentorship/list/index.yml):listMentorship}
  deleteMentorship: ${file(src/functions/Mentorship/delete/index.yml):deleteMentorship}

  # APPOINTMENTS
  createAppointment: ${file(src/functions/appointments/create/index.yml):createAppointment}

  # DOCUMENT
  createDocument: ${file(src/functions/docs/Upload/index.yml):createDocument}
  listDocuments: ${file(src/functions/docs/list/index.yml):listDocuments}

  #Currency
  listCurrency: ${file(src/functions/Currency/list/index.yml):listCurrency}

  #Category
  findCategory: ${file(src/functions/Category/find/index.yml):findCategory}
  listCategory: ${file(src/functions/Category/list/index.yml):listCategory}

  #Subject
  findSubject: ${file(src/functions/Subject/find/index.yml):findSubject}
  listSubject: ${file(src/functions/Subject/list/index.yml):listSubject}

plugins:
  - serverless-offline
  - serverless-prune-plugin
  - serverless-plugin-typescript
